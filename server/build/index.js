(()=>{"use strict";var e={233:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function u(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.db_close=t.db_connect=void 0;const i=r(n(185));n(81);const s=r(n(357)),u=process.env.MONGODB_URI||"",c={useNewUrlParser:!0,useUnifiedTopology:!0},a=i.default;t.db_connect=()=>o(void 0,void 0,void 0,(function*(){console.log(s.default.yellow("\nMONGOBD IS STARTING ON: "+s.default.underline(process.env.MONGODB_URI||""))),yield a.connect(u,c)})),t.db_close=()=>o(void 0,void 0,void 0,(function*(){yield a.connection.close()})),t.default=a},607:function(e,t,n){e=n.nmd(e);var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function u(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(233),s=r(n(860));n(81);const u=r(n(357)),c=n(345),a=r(n(299)),d=(0,s.default)(),l=process.env.PORT,f=n(986);d.use(f.json()),d.use(f.urlencoded({extended:!0})),d.use("/api/",a.default),d.get("/",((e,t)=>{t.send({message:"hello world"})})),o(void 0,void 0,void 0,(function*(){yield(0,i.db_connect)(),yield(0,c.vk_connect)(),n.c[n.s]===e&&d.listen(l,(()=>{console.log(u.default.green("Server was started at http://localhost: ")+u.default.underline(l||""))}))})),t.default=d},936:(e,t,n)=>{const o=n(185),r=o.Schema({text:String,link:String});e.exports=o.model("PostFromVK",r)},299:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function u(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(860)),s=n(345),u=i.default.Router(),c=n(936);u.get("/vk/get",((e,t)=>{c.find({},((e,n)=>{e?t.status(400):t.send(n)}))})),u.post("/vk/search",((e,t)=>o(void 0,void 0,void 0,(function*(){let n=e.body.groups,o=e.body.keywords,r=e.body.every;if(n&&o){Array.isArray(n)||(n=[n]),Array.isArray(o)||(o=[o]);const e=e=>{if(r){if(o.every((t=>e.text.toLowerCase().includes(t))))return!0}else if(o.some((t=>e.text.toLowerCase().includes(t))))return!0;return!1};let i=n.map((e=>s.vk.post("wall.get",{domain:e,count:100})));Promise.all(i).then((n=>{let o=n.map((e=>e.items)).flat().filter((t=>e(t))),r={data:o,counts:o.length};o.forEach((e=>{new c({text:e.text,link:e.id}).save()})),t.status(200),t.send(r)}))}else t.status(400),t.send("Error. Property groups or keywords is invalid. Please read docs.")})))),t.default=u},345:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function u(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.vk_connect=t.vk=void 0;const i=r(n(17)),s=n(700);let u;t.vk=u,t.vk_connect=()=>o(void 0,void 0,void 0,(function*(){console.log("Vk is starting...\n"),t.vk=u=yield s({token:process.env.VK_TOKEN,sessionFile:i.default.join(__dirname,".my-session")})}))},986:e=>{e.exports=require("body-parser")},357:e=>{e.exports=require("colors")},81:e=>{e.exports=require("dotenv/config")},700:e=>{e.exports=require("easyvk")},860:e=>{e.exports=require("express")},185:e=>{e.exports=require("mongoose")},17:e=>{e.exports=require("path")}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.c=t,n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n(n.s=607)})();